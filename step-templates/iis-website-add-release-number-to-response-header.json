{
  "Id": "ActionTemplates-3",
  "Name": "IIS Website - Add Release Number to Response Header",
  "Description": "Adds the Octopus Deploy Release number to the IIS response header. When you browse your site you can look at the response header to verify the build number that is running.",
  "ActionType": "Octopus.Script",
  "Version": 3,
  "Properties": {
    "Octopus.Action.Script.ScriptBody": "Write-Host \"#Adding release number to response header\"\n\n[System.Reflection.Assembly]::LoadWithPartialName(\"Microsoft.Web.Administration\") | Out-Null\n$iis = new-object Microsoft.Web.Administration.ServerManager\n$config = $iis.GetWebConfiguration($OctopusParameters['webSiteName'])\n$httpProtocolSection = $config.GetSection(\"system.webServer/httpProtocol\")\n$customHeadersCollection = $httpProtocolSection.GetCollection(\"customHeaders\")\n\n$update = $false\n\nforeach($path in $customHeadersCollection.GetCollection()) { \n    if ($path.GetAttributeValue(\"name\") -eq $OctopusParameters['FieldName']) {\n        write-host \"Release number is already in the response header, skipping\"\n        $update = $false\n        break\n    } else {\n        $update = $true\n    }\n}\n\nif ($update)\n{\n    Write-Host \"Adding release number\"\n    $addElement = $customHeadersCollection.CreateElement(\"add\")\n    $addElement[\"name\"] = $OctopusParameters['FieldName']\n    $addElement[\"value\"] = $OctopusParameters[\"Octopus.Release.Number\"]\n    $customHeadersCollection.Add($addElement)\n    $iis.CommitChanges() | Write-Host\n}"
  },
  "SensitiveProperties": {},
  "Parameters": [
    {
      "Name": "FieldName",
      "Label": "Field name",
      "HelpText": "The name of the the Field name you want the release to show as.",
      "DefaultValue": "Release",
      "DisplaySettings": {}
    },
    {
      "Name": "WebsiteName",
      "Label": "Website name",
      "HelpText": "The name of the site in IIS",
      "DefaultValue": null,
      "DisplaySettings": {}
    }
  ],
  "LastModifiedOn": "2015-08-28T11:39:07.139+00:00",
  "LastModifiedBy": "gormac",
  "$Meta": {
    "ExportedAt": "2015-08-28T12:37:06.927Z",
    "OctopusVersion": "2.6.4.951",
    "Type": "ActionTemplate"
  }
}